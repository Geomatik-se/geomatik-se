---
title: 'Bevölkerungswachstum und Bevölkerungsdichte Schweden 2021 '
output:
  html_document:
    df_print: paged
  flexdashboard::flex_dashboard:
    storyboard: yes
    css: styles.css
    logo: logo.png
    favicon: favicon.png
  word_document: default
  pdf_document: default
---



```{r include=FALSE}

library(knitr)
library(kableExtra)
library(flexdashboard)
library(WDI)
library(tidyverse)
library(plotly)
library(crosstalk)
library(ggthemes)
library(ggplot2)
library(knitr)
library(esquisse)
library(DT)
library(Rcmdr)
library(leaflet)
library(dplyr)
library(ggmap)
library(rgdal)
library(htmltools)
library(mapview)
library(htmlwidgets)
library(maps)
library(leaflet.extras)
library(leaflet)
library(readxl)

```
Karten {.storyboard}
=====================================


### Übersichtskarte Bevölkerung A


Schweden 2021



```{r include=FALSE}

#Load counties shape file.
region <- readOGR("sverige4.shp")

#region$Einwohner <- as.character(as.numeric(region$Einwohner))

bins=c(0, 150000, 250000, 600000, 1500000, 2700000 )
pal = colorBin(palette = "YlOrBr", region$bev, bins=bins, ".")


region$label <- paste("<p>", region$Län, "</p>",
                         "<p>", "Bevölkerung:", " ",region$bev, " ", "</p>",
                           "<p>", "Bevölkerungsdichte:", " ",region$bevdi, " ", "</p>",
                      "<p>", "Bevölkerungswachstum:", " ", region$Differenz, "</p>",
                           sep="")

#add shapefile with the addPolygons function
m2 <- leaflet(data = region) %>%
  addTiles(group = "OpenStreetMap") %>%
        addProviderTiles(providers$Esri.WorldStreetMap, options = tileOptions(minZoom=0, maxZoom=13), group = "Esri.WorldStreetMap") %>%
      
      addProviderTiles(providers$Esri.WorldImagery, options=tileOptions(minZoom=0, maxZoom=13), group = "Esri.WorldImagery") %>%
      
      addLayersControl(
        baseGroups = c("OpenStreetMap", "Esri.WorldStreetMap", "Esri.WorldImagery"),
        #overlayGroups = c("Markers", "Points"),
        options = layersControlOptions(collapsed=TRUE)
      ) %>%
    
  setView(lng = 12, lat = 62.6, zoom = 5) %>%
  
  
  addPolygons(data = region,
              fillColor = ~pal(bev),
              weight = 1, 
              smoothFactor = 0.5,
              color = "white",
              fillOpacity = 0.8,
              label = lapply(region$label, HTML)) %>%

  addLegend(
        pal=pal,
        values = ~bev,
        position = "bottomright",
        title ="Bevölkerung")






```

```{r echo=FALSE}
m2
```

### Übersichtskarte Bevölkerungsdichte


Schweden 2021



```{r include=FALSE}

#Load counties shape file.
region <- readOGR("sverige4.shp")

region$Einwohner <- as.character(as.numeric(region$Einwohner))

bins=c(0, 5, 20, 50, 100, 1000, 2500)
pal = colorBin(palette = "YlOrBr", region$bevdi, bins=bins, ".")


region$label <- paste("<p>", region$Län, "</p>",
                       "<p>", "Bevölkerung:", " ",region$bev, " ", "</p>",
                           "<p>", "Bevölkerungsdichte:", " ",region$bevdi, " ", "</p>",
                      "<p>", "Bevölkerungswachstum:", " ", region$Differenz, "</p>",
                           sep="")

#add shapefile with the addPolygons function
m3 <- leaflet(data = region) %>%
  addTiles(group = "OpenStreetMap") %>%
        addProviderTiles(providers$Esri.WorldStreetMap, options = tileOptions(minZoom=0, maxZoom=13), group = "Esri.WorldStreetMap") %>%
      
      addProviderTiles(providers$Esri.WorldImagery, options=tileOptions(minZoom=0, maxZoom=13), group = "Esri.WorldImagery") %>%
      
      addLayersControl(
        baseGroups = c("OpenStreetMap", "Esri.WorldStreetMap", "Esri.WorldImagery"),
        #overlayGroups = c("Markers", "Points"),
        options = layersControlOptions(collapsed=TRUE)
      ) %>%
    
  setView(lng = 12, lat = 62.6, zoom = 5) %>%
  
  
  addPolygons(data = region,
              fillColor = ~pal(bevdi),
              weight = 1, 
              smoothFactor = 0.5,
              color = "white",
              fillOpacity = 0.8,
              label = lapply(region$label, HTML)) %>%

  addLegend(
        pal=pal,
        values = ~bevdi,
        position = "bottomright",
        title ="Bevölkerungsdichte")






```

```{r echo=FALSE}
m3
```

### Übersichtskarte Bevölkerungswachstum


Schweden 2021




```{r include=FALSE}

#Load counties shape file.
region <- readOGR("sverige4.shp")

region$Einwohner <- as.character(as.numeric(region$Einwohner))

bins=c(-500, 0, 1000, 2000, 5000, 15000, 25000)
pal = colorBin(palette = "YlOrBr", region$diff, bins=bins, ".")


region$label <- paste("<p>", region$Län, "</p>",
                       "<p>", "Bevölkerung:", " ",region$bev, " ", "</p>",
                           "<p>", "Bevölkerungsdichte:", " ",region$bevdi, " ", "</p>",
                      "<p>", "Bevölkerungswachstum:", " ", region$Differenz, "</p>",
                           sep="")

#add shapefile with the addPolygons function
m <- leaflet(data = region) %>%
  addTiles(group = "OpenStreetMap") %>%
        addProviderTiles(providers$Esri.WorldStreetMap, options = tileOptions(minZoom=0, maxZoom=13), group = "Esri.WorldStreetMap") %>%
      
      addProviderTiles(providers$Esri.WorldImagery, options=tileOptions(minZoom=0, maxZoom=13), group = "Esri.WorldImagery") %>%
      
      addLayersControl(
        baseGroups = c("OpenStreetMap", "Esri.WorldStreetMap", "Esri.WorldImagery"),
        #overlayGroups = c("Markers", "Points"),
        options = layersControlOptions(collapsed=TRUE)
      ) %>%
    
  setView(lng = 12, lat = 62.6, zoom = 5) %>%
  
  
  addPolygons(data = region,
              fillColor = ~pal(diff),
              weight = 1, 
              smoothFactor = 0.5,
              color = "white",
              fillOpacity = 0.8,
              label = lapply(region$label, HTML)) %>%

  addLegend(
        pal=pal,
        values = ~diff,
        position = "bottomright",
        title ="Bevölkerungswachstum")






```

```{r echo=FALSE}
m
```
Eingangsdaten {data-orientation=rows, .storyboard}
=====================================  

### Tabelle 

```{r}
data_tabelle2_2021_csv <- read.csv2("regionen2021.csv")

datatable(
  data_tabelle2_2021_csv, 
  filter = 'top', 
  colnames = c("Region (Provinz)", "Bevölkerung", "Bev.-Wachstum 2021", "Areal in km²", "Bev.-Dicht in Enw pro km²", "Landesteil", "Länskod"),
  caption = 'Schweden 2021 in Zahlen',
  extensions = 'Buttons',
    options = list(dom = 'Bftrip',
        buttons = c('copy', 'csv', 'pdf', 'print')
))



```



### Grafik 1 Graphische Auswahl der Daten (dynamisch)  {data-height=200}




```{r echo=FALSE,  fig.width = 4, fig.height = 3}

data_2021 <- read_excel("beispiel_1.xlsx")

data_n <- data_2021

p <- ggplot(data_n) +
  aes(
    x = Bevölkerungsdichte,
    y = Bevölkerungswachstum,
    colour = Region,
    size = Bevölkerung
  ) +
  geom_point(shape = "circle") +
  scale_color_hue(direction = 1) +
  scale_x_continuous(trans = "log10") +
  theme_minimal()

ggplotly(p)



```

### Grafik 2 Detaillierte Auswahl der Daten (dynamisch)

```{r plotly-crosstalk}

data_n <- data_2021
shared_data <- data_n %>% 
  select(Region, Bevölkerung, Bevölkerungswachstum, Areal, Bevölkerungsdichte, Landesteil) %>% 
  na.omit() %>% 
  mutate(region = stringr::str_replace(Region, "&", "and"),
          Bevölkerung= round(Bevölkerung, 1),
          Areal = round(Areal, 1)) %>% 
  SharedData$new()

p <- shared_data %>% 
  plot_ly(x = ~Bevölkerungsdichte, y = ~Bevölkerungswachstum, color = ~region,
              hoverinfo = "text",
              text = ~paste("Region:", Region,
                            "<br>Bevölkerung:", Bevölkerung,
                            "<br>Bevölkerungsdichte:",Bevölkerungsdichte,
                            "<br>Bevölkerungswachstum:", Bevölkerungswachstum)) %>% 
  group_by(region) %>% 
  add_markers(size = 3) %>%
  layout(xaxis = list(title = "Bevölkerungswachstum"),
         yaxis = list(title = "Einwohner"),
         legend = list(font = list(size = 16)))

# Combining several selectors

bscols(widths = c(3, 9),
       list(
            filter_checkbox(id = "Landesteil", label = "Landesteil",
                    sharedData = shared_data, group = ~Landesteil),
            filter_select(id = "Region", label = "Region",
                    sharedData = shared_data, group = ~Region),
            filter_slider(id = "slider_ap", label = "Areal in km²",
                    sharedData = shared_data, column = ~Areal),
            filter_slider(id = "slider_ap", label = "Bevölkerungsdichte",
                    sharedData = shared_data, column = ~Bevölkerungsdichte),            
            filter_slider(id = "slider_le", label = "Bevölkerungswachstum",
                    sharedData = shared_data, column = ~Bevölkerungswachstum)
      ),
       p)

```

Statistische Analyse {.storyboard}
=====================================


### Diagramm der linearen Regression




```{r}
library(ggplot2)

b <- ggplot(data_n, aes(x = Bevölkerungsdichte, y = Bevölkerungswachstum)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, size = 0.5) +
  labs(x = "Bevölkerungsdichte (in Einwohner pro km²)", y = "Bevölkerungswachstum 2021          ",
       title = "Zusammenhang zwischen Bevölkerungsdichte und Bevölkerungswachstum")


ggplotly(b)

```



### Statistische Auswertung

```{r}

model3 <- lm(Bevölkerungswachstum~Bevölkerungsdichte, data = data_n)
summary(model3)

```

```
